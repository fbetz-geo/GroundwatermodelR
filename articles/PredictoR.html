<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GroundwatermodelR">
<title>Predictions for new data based on existing model • GroundwatermodelR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predictions for new data based on existing model">
<meta property="og:description" content="GroundwatermodelR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GroundwatermodelR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Analysis.html">How to use GroundwatermodelR to conduct analysis with existing raster time series</a>
    <a class="dropdown-item" href="../articles/PredictoR.html">Predictions for new data based on existing model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Predictions for new data based on existing model</h1>
                        <h4 data-toc-skip class="author">Florian
Betz</h4>
            
            <h4 data-toc-skip class="date">2023-05-02</h4>
      
      
      <div class="d-none name"><code>PredictoR.Rmd</code></div>
    </div>

    
    
<p>Once a trained model is available, it can be used for the prediction
of new time steps. For model training, you can refer to the excellent <a href="https://hannameyer.github.io/CAST/" class="external-link">tutorials of the CAST
package</a>.</p>
<p>First, we need to make sure, that GroundwatermodelR is available. It
can be installed from github using the remotes package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(remotes)</span></span>
<span><span class="co">#install_github(fbetz-geo/GroundwatermodelR)</span></span>
<span><span class="co">#library(GroundwatermodelR)</span></span></code></pre></div>
<p>Yiu might have used the option to store a trained model to use it for
later prediction or prediction on new time steps. Models trained by the
‘caret’ (and thus also by the CAST package can be stored as RDS file and
re-loaded to new R sessions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Read model from file</span></span>
<span><span class="co">#model&lt;-readRDS(model_file)</span></span></code></pre></div>
<p>Afterwards, the model can be used for new predictions. To avoid
issues arising from predictions beyond the training space of the model,
it is recommended to include an analysis of the area of applicability <a href="https://doi.org/10.1111/2041-210X.13650" class="external-link">(Meyer &amp; Pebesma,
2021)</a>. In addition, I recommend to analyze the whether the temporal
predictors for new predictions fall within the range of the value range
of the predictors in the training period. If a model was saved using
saveRDS(), the loaded model will contain the training data as well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#train_data&lt;-model$trainData</span></span>
<span><span class="co">#head(train_data)</span></span></code></pre></div>
<p>You can the agreement between training and new data easily
visualizing the densities of the datasets. Let’s merge the two datasets
first:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load required packages</span></span>
<span><span class="co">#library(tidyr)</span></span>
<span><span class="co">#library(dplyr)</span></span>
<span></span>
<span><span class="co">#old data</span></span>
<span><span class="co">#old_data&lt;-model$trainingData %&gt;% </span></span>
<span>  </span>
<span>  <span class="co">#Select only columns with temporal (i.e. variable) predictors</span></span>
<span><span class="co">#  select(c("Discharge_Danube","Stage_OHB")) %&gt;% </span></span>
<span>  </span>
<span>  <span class="co">#Add column to mark data as initial training data</span></span>
<span><span class="co">#  mutate(Class="Training Data")</span></span>
<span></span>
<span><span class="co">#new data, make sure to have matching column names!</span></span>
<span><span class="co">#new_data&lt;-read.table("New_data.txt",header = TRUE,sep="\t",dec=",") %&gt;% </span></span>
<span>  </span>
<span>  <span class="co">#Add column to mark as new data</span></span>
<span>  <span class="co">#mutate(Class="New Prediction Data")</span></span>
<span></span>
<span><span class="co">#Combine the two data.frames</span></span>
<span><span class="co">#vis&lt;-rbind(old_data,new_data) %&gt;% </span></span>
<span>  </span>
<span>  <span class="co">#Make it long format, cols refer to the columns with temporal predictors</span></span>
<span>  <span class="co">#pivot_longer(cols=c("Discharge_Danube","Stage_OHB"))</span></span></code></pre></div>
<p>Now, we have a data.frame with new and old data and can visualize the
densities:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(ggplot2)</span></span>
<span></span>
<span><span class="co">#Set up plot</span></span>
<span><span class="co">#p&lt;-ggplot(aes(y=value,color=Class),data=vis)</span></span>
<span></span>
<span><span class="co">#Make plot</span></span>
<span><span class="co">#p+geom_density()+facet_wrap(~name,scale="free")</span></span></code></pre></div>
<p>If the densities of the training and new prediction data agree
sufficiently well, we can consider the new data to be in the training
range of the model and go on with the prediction. For this task, we use
the predictoR function from the GroundwatermodelR package.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Set the model path</span></span>
<span><span class="co">#model&lt;-"Path/to/Your/Model"</span></span>
<span></span>
<span><span class="co">#Load spatial predictors</span></span>
<span><span class="co">#spatial_predictors&lt;-rast("Your_Predictors.grd")</span></span>
<span></span>
<span><span class="co">#Load temporal predictors</span></span>
<span><span class="co">#temp_predictors&lt;-read.table("Your_temp_predictors.txt",header=TRUE, sep="\t",dec=".")</span></span>
<span></span>
<span><span class="co">#Specify output directory</span></span>
<span><span class="co">#out_dir&lt;-"Your/Output/Direction"</span></span>
<span></span>
<span><span class="co">#Apply predictoR function</span></span>
<span><span class="co">#predictoR(model=model,spat_predictors = spatial_predictors,temp_predictors =temp_predictors)</span></span></code></pre></div>
<p>This will result in one new prediction for each time step in the
temp_predictors dataset. Please note, that depending on the model used
(usually Random Forest or similar), the prediction is a time consuming
process and can have long run times even it uses parallel processing on
all available cores by default. Therefore, information about the
progress is included.</p>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Florian Betz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
